{{ $related := .Site.RegularPages.Related . | first 3 }}
{{ if $related }}
<section class="related-posts">
  <h3 class="related-posts-title">{{ i18n "related_posts" | default "Related Posts" }}</h3>
  
  <div class="related-posts-grid">
    {{ range $related }}
      <article class="related-post-card">
        {{ if .Params.featured_image }}
          <div class="related-post-image">
            <a href="{{ .RelPermalink }}">
              <img src="{{ .Params.featured_image | relURL }}" alt="{{ .Title }}" loading="lazy">
            </a>
          </div>
        {{ end }}
        
        <div class="related-post-content">
          <h4 class="related-post-title">
            <a href="{{ .RelPermalink }}">{{ .Title }}</a>
          </h4>
          
          {{ if .Summary }}
            <p class="related-post-excerpt">{{ .Summary | truncate 80 }}</p>
          {{ end }}
          
          <div class="related-post-meta">
            <time datetime="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}" class="post-date">
              {{ .Date.Format (.Site.Params.dateFormat | default "2006年1月2日") }}
            </time>
          </div>
        </div>
      </article>
    {{ end }}
  </div>
</section>
{{ end }}
